This file describes how to install generators to MCGenerators trees:

1. Download new authors tarfile to local source tarfile repository:
	a. Obtain sftnight AFS token;
	b. Download source tarball into /afs/cern.ch/sw/lcg/external/tarFiles/MCGeneratorsTarFiles;

2. Add package definition to requested version of LCGCMT release: cmake/toolchain/heptools-<release>.cmake;

3. Try build on local node and run GENSER test for the given package;

4. Commit changes into SVN;

5. Go to https://ecsft.cern.ch/ and submit jobs for all requested releases;
   Don't install more then one full release at once!

6. If the installation is successfull, mail to genser-announce@cern.ch like this:
    Dear colleagues,
    New Tauola++ version - Tauola++ 1.1.4 has been installed into MCGenerators lcgcmt trees:

       - MCGenerators_lcgcmt65
       - MCGenerators_lcgcmt65a
       - MCGenerators_lcgcmt66
        ---
           Best regards,
                       GENSER

### 
### Installation of LCG_68 and newer releases 
###

1. Steps 1-4 from the instruction above.

5. Build generators in a temporary location (e.g. /afs/cern.ch/sw/lcg/external/MCGenerators_test1/)
   If you add a generator version, build it against existing AFS installation, e.g. /afs/cern.ch/sw/lcg/releases/LCG_70
   If you reinstall a generator or a version, use argument -DLCG_IGNORE='generatorname1;generatorname2'
   cd to the temporary location above

6. Create the summary files for a release
   .../lcgcmake/cdash/extract_LCG_summary.py . <platform> <release version> UPGRADE
   (old location of this script: /afs/cern.ch/sw/lcg/app/spi/tools/LCGRPM/package/extract_LCG_summary.py)
   (alternatives for the last argument: UPGRADE or RELEASE)
   (example is below)
    # .../lcgcmake/cdash/extract_LCG_summary.py/extract_LCG_summary.py . x86_64-slc6-gcc48-opt 69root6 UPGRADE

  The files LCG_*.txt should be created. (contrib, generators, externals)

  As the system was not finished, the following hand procedure was to be made (once per XX, after LCG_XX installation):
  (this is already made in 70 and 70root6)
  cd /afs/cern.ch/sw/lcg/releases/LCG_XX
  cp *.txt *.txt.old
  mv *.txt.installed *.txt (only generators is usually sufficient)
  add headers to *.txt as they are in *.txt.old

7. Create RPM spec file
  a) Determine the current release number
     ls /afs/cern.ch/sw/lcg/external/rpms/lcg/ | grep LCG_generators | grep 69root6
     Output is:
       LCG_generators_69root6_x86_64_slc6_gcc48_opt-1.0.0-6.noarch.rpm
       LCG_generators_69root6_x86_64_slc6_gcc48_opt-1.0.0-7.noarch.rpm
       LCG_generators_69root6_x86_64_slc6_gcc48_opt-1.0.0-8.noarch.rpm
                                                        -> <- is release number
     Use next release number (9 in this case)
  b) Prepare temporary build directory TMPRPM (for example TMPRPM=/tmp/sftnight)
     rm -rf ${TMPRPM}/*
  c) Produce .spec file
     /afs/cern.ch/sw/lcg/app/spi/tools/LCGRPM/package/createLCGRPMSpec.py LCG_generators_x86_64-slc6-gcc48-opt.txt -b ${TMPRPM} -o generators.spec --release <release number>

8. Make rpm
   rpmbuild -bb generators.spec

   comment: if you substitute some generators version, at this point you will have an error because of duplicate generator.
            You should remove the old one from the txt file obtained at step 6 and repeat step 7

9. Copy rpm (this step and steps 10 - 11 require permissions, to be done from sftnight)
   cp -v -i ${TMPRPM}/rpmbuild/RPMS/noarch/*.rpm /afs/cern.ch/sw/lcg/external/rpms/lcg/
   There is a script .../lcgcmake/cdash/copyRPMS.py, but it does not deal with LCG_Generators, so not to be used for now:
   export TMP_RPM_AREA=${TMPRPM}    (temporary build area from above)
   .../lcgcmake/cdash/copyRPMS.py

10. Update rpm database (use createrepo or createrepo_c) (takes about 10 mins)
   createrepo_c --workers=20 /afs/cern.ch/sw/lcg/external/rpms/lcg/

11. Install to AFS
  a) Prepare environment
     export MYSITEROOT=/afs/cern.ch/sw/lcg/releases/
  b) Install 
     List rpms
       /afs/cern.ch/sw/lcg/app/spi/tools/LCGRPM/install/lcg_install.sh list | grep LCG_generators_69root6
     Install
      /afs/cern.ch/sw/lcg/app/spi/tools/LCGRPM/install/lcg_install.sh --rpmupdate install LCG_generators_69root6_x86_64_slc6_gcc48_opt-1.0.0-9
  c) If the error is occurred try to install target package (LCG_68_root6_lhapdf6_6.1.4_x86_64_slc6_gcc48_opt-1.0.0-11 for example) instead of full generators set (LCG_generators_68_root6_x86_64_slc6_gcc48_opt-1.0.0-11)

12. Check that the new generators are installed on AFS

13. If the installation is successfull, mail to genser-announce@cern.ch.

In case of questions or problems mail to Benedikt.Hegner@cern.ch and genser-dev
